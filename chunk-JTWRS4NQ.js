import{b as Ne}from"./chunk-5GLGBK3X.js";import{e as U,f as Z,g as b,h as z}from"./chunk-JOZYFTCA.js";import{d as P}from"./chunk-XT64ZN6M.js";import"./chunk-X5YLR3NI.js";import"./chunk-FK6H3RFT.js";import{B as Ie,V as Te,h as ve,i as ye,k as we,l as xe,m as be,n as Me,o as Ee,r as Se,s as Fe,u as Pe,x as De,y as Oe}from"./chunk-M23HUVHI.js";import"./chunk-2PPFUFFT.js";import{h as ce,j as m,m as le,n as me,p as de,q as se,r as ue,s as pe,t as fe,u as ge,v as Ce,w as _e,za as he}from"./chunk-CL6E2KIN.js";import{Db as h,Fb as B,Gb as k,Hb as Y,Ib as n,Jb as r,Kb as E,Ob as ee,Rb as u,Tb as H,X as W,Xa as l,Xc as ae,Yb as v,Yc as oe,Zb as y,Zc as T,_b as w,ba as F,cc as R,dc as o,eb as O,ec as x,fc as te,gc as ie,hc as ne,ja as p,ka as f,pc as I,qc as re,rc as A,ta as V,vb as _,wb as K,xa as X,xb as g}from"./chunk-37SYL4M2.js";import{i as $}from"./chunk-ODN5LVDJ.js";var N=class c{CERTIFICATE_PREFIX="CDC";HASH_LENGTH=3;RANDOM_LENGTH=2;generateCertificateCode(t,e,i){let a=new Date,d=a.getFullYear(),s=this.generateYearCode(d),M=this.hashString(t).slice(0,this.HASH_LENGTH),C=this.generateRandomString(this.RANDOM_LENGTH);return{code:`${this.CERTIFICATE_PREFIX}-${s}${M}${C}`,metadata:{generatedAt:a.getTime(),formattedDate:b(a,"dd/MM/yyyy"),validFrom:b(Z(a),"yyyy-MM-dd"),validUntil:b(U(new Date(e,0)),"yyyy-MM-dd"),formattedValidFrom:b(Z(a),"dd/MM/yyyy"),formattedValidUntil:b(U(new Date(e,0)),"dd/MM/yyyy"),studentId:t,courseId:i,yearCode:s,validity:{startYear:d,endYear:e,durationYears:e-d}}}}generateYearCode(t){return b(new Date(t,0),"yy")}generateRandomString(t){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";return Array.from({length:t},()=>e.charAt(Math.floor(Math.random()*e.length))).join("")}hashString(t){let e=0;for(let a=0;a<t.length;a++){let d=t.charCodeAt(a);e=(e<<5)-e+d,e=e&e}return Math.abs(e).toString(36).toUpperCase().replace(/[^A-Z0-9]/g,"")}validateCertificateCode(t){return new RegExp(`^${this.CERTIFICATE_PREFIX}-[A-Z0-9]{7}$`).test(t)}decodeCertificateCode(t,e){if(!this.validateCertificateCode(t))return null;try{let[i,a]=t.split("-"),d=a.slice(0,2),s=a.slice(2,5),M=a.slice(5,7),C=parseInt("20"+d),S=new Date(C,0,1),D=new Date(C,11,31),L=!1,G=!1;return e&&(G=this.hashString(e).slice(0,this.HASH_LENGTH)===s,L=G),{isValid:!0,isAuthentic:L,details:{prefix:i,issuedYear:C,validityYears:1,endYear:C,studentHash:s,randomIdentifier:M,dates:{issuedDate:b(S,"dd/MM/yyyy"),expirationDate:b(D,"dd/MM/yyyy")}},verification:{studentIdProvided:!!e,studentIdMatch:G,originalStudentId:G?e:void 0},reconstructedCode:t}}catch(i){return console.error("Error decoding certificate:",i),null}}static \u0275fac=function(e){return new(e||c)};static \u0275prov=W({token:c,factory:c.\u0275fac,providedIn:"root"})};var q=["Administraci\xF3n de Medicamentos","Aspectos Legales","Ataque con Sustancias Qu\xEDmicas","Atenci\xF3n a Victimas de Violencia Sexual","Cuidado del Donante","Cuidados Paliativos","Humanizaci\xF3n en Salud","Inyectolog\xEDa Intramuscular","Manejo del Duelo","Primeros Auxilios","Protecci\xF3n Radiol\xF3gica","Soporte Vital Avanzado","Soporte Vital B\xE1sico","Sueroterapia","Toma de Citolog\xEDa Cervicouterina","Toma de Muestras de Laboratorio","Toma de Muestras POCT","V\xEDctimas del conflicto armado"];var Ae=["nameInput"],qe=["docInput"],Le=["placeInput"],Ge=["emailInput"],ke=["hoursInput"],Ye=(c,t)=>t.tipo;function He(c,t){c&1&&(n(0,"mat-error"),o(1,"El nombre es requerido y debe tener al menos 3 caracteres"),r())}function ze(c,t){if(c&1&&(n(0,"mat-option",16),o(1),r()),c&2){let e=t.$implicit;g("value",e.tipo),l(),x(e.tipo)}}function Qe(c,t){c&1&&(n(0,"mat-error"),o(1,"Seleccione un tipo de documento"),r())}function je(c,t){if(c&1&&(n(0,"mat-error"),o(1),r()),c&2){let e=H();l(),x(e.getDocumentErrorMessage())}}function $e(c,t){c&1&&(n(0,"mat-error"),o(1,"El lugar de expedici\xF3n es requerido"),r())}function Be(c,t){c&1&&(n(0,"mat-error"),o(1,"Ingrese un correo electr\xF3nico v\xE1lido"),r())}function Ue(c,t){if(c&1&&(n(0,"mat-option",16),o(1),r()),c&2){let e=t.$implicit;g("value",e),l(),x(e)}}function Ze(c,t){if(c&1&&(n(0,"mat-option",16),o(1),r()),c&2){let e=t.$implicit;g("value",e),l(),x(e)}}function Je(c,t){c&1&&(n(0,"mat-error"),o(1,"Seleccione el a\xF1o de validez"),r())}function We(c,t){c&1&&(n(0,"mat-error"),o(1,"La cantidad de horas debe ser mayor a 0"),r())}var Q=class c{nameInput;docInput;placeInput;emailInput;hoursInput;isPreviewGenerated=!1;certificateCode="";previewGenerated=new V;downloadRequested=new V;saveRequested=new V;formValueChanged=new V;certificateForm;filteredCourses=q;YEARS_TO_SHOW=5;certificateGenerated=!1;isGenerating=!1;currentDate=new Date;yearSelected=new Date;documentTypes=[];selectedDocumentType=null;validityYears=[];certificateMetadata=null;certificate;_fb=F(ge);_certificateSrv=F(z);_certificateCodeSrv=F(N);ngOnInit(){this.initForm(),this.generateValidityYears(),this.loadDocumentTypes()}initForm(){this.certificateForm=this._fb.group({studentName:["",[m.required,m.minLength(3)]],documentType:["",[m.required]],documentNumber:["",[m.required]],expeditionPlace:["",[m.required,m.minLength(3)]],courseName:["",[m.required,m.minLength(3)]],hours:["",[m.required,m.min(1)]],email:["",[m.required,m.email]],validityYear:["",[m.required]]}),this.certificateForm=this._fb.group({studentName:["NESTOR IV\xC1N MARTINEZ COBO",[m.required,m.minLength(3)]],documentType:["CC",[m.required]],documentNumber:["1061779667",[m.required]],expeditionPlace:["POPAY\xC1N",[m.required,m.minLength(3)]],courseName:["Humanizaci\xF3n de los Servicios de Salud",[m.required,m.minLength(3)]],hours:["40",[m.required,m.min(1)]],email:["sksmartinez@gmail.com",[m.required,m.email]],validityYear:["2026",[m.required]]}),this.setupFormValidations()}setupFormValidations(){this.certificateForm.get("documentType")?.valueChanges.subscribe(t=>{this.selectedDocumentType=this.documentTypes.find(e=>e.tipo===t)??null,this.updateDocumentValidations()}),this.certificateForm.get("validityYear")?.valueChanges.subscribe(t=>{t&&(this.yearSelected=new Date(parseInt(t),0,1))}),this.certificateForm.get("courseName")?.valueChanges.subscribe(t=>{typeof t=="string"&&!q.includes(t)&&this.filterCourses({target:{value:t}})}),this.certificateForm.valueChanges.subscribe(t=>{this.formValueChanged.emit(t)})}updateDocumentValidations(){if(this.selectedDocumentType)try{let t=this.selectedDocumentType.reglasValidacion.replace(/(['"])?([a-zA-Z0-9_]+)(['"])?:/g,'"$2":').replace(/'/g,'"').replace(/\s/g,""),e=JSON.parse(t),i=[m.required];e.min&&i.push(m.minLength(e.min)),e.max&&i.push(m.maxLength(e.max)),e.pattern&&i.push(m.pattern(e.pattern)),this.certificateForm.get("documentNumber")?.setValidators(i),this.certificateForm.get("documentNumber")?.updateValueAndValidity()}catch(t){console.error("Error parsing validation rules:",t),this.certificateForm.get("documentNumber")?.setValidators([m.required,m.minLength(3),m.maxLength(20)])}}generateValidityYears(){let t=new Date().getFullYear();this.validityYears=Array.from({length:this.YEARS_TO_SHOW},(e,i)=>t+i+1)}onInputTransform(t,e){let a=t.target.value;switch(e){case"studentName":case"expeditionPlace":a=a.toUpperCase();break;case"email":a=a.toLowerCase();break}this.certificateForm.get(e)?.setValue(a,{emitEvent:!1})}loadDocumentTypes(){this._certificateSrv.getDocumentTypes().subscribe({next:t=>{this.documentTypes=t,console.log(this.documentTypes)},error:t=>{console.error("Error loading document types:",t)}})}filterCourses(t){let e=t.target.value,i=this.certificateForm.get("courseName")?.value;typeof i=="string"&&q.includes(i)&&e!==i&&this.certificateForm.patchValue({courseName:""});let a=e.toLowerCase();this.filteredCourses=q.filter(d=>d.toLowerCase().includes(a))}displayFn(t){return t||""}onCourseSelected(t){let e=document.querySelector('input[formControlName="courseName"]');e&&e.blur()}clearField(t,e){this.certificateForm.get(t)?.reset(),e instanceof X?e.nativeElement.focus():e.focus()}getDocumentErrorMessage(){let t=this.certificateForm.get("documentNumber");if(!t?.errors)return"";try{let e=this.parseValidationRules(this.selectedDocumentType?.reglasValidacion||"");if(t.errors.required)return"El n\xFAmero de documento es requerido";if(t.errors.minlength)return`El documento debe tener m\xEDnimo ${e.min} caracteres`;if(t.errors.maxlength)return`El documento debe tener m\xE1ximo ${e.max} caracteres`;if(t.errors.pattern)return{"[0-9]+":"Solo se permiten n\xFAmeros","[A-Za-z0-9]+":"Solo se permiten letras y n\xFAmeros","[0-9]{8}":"Debe contener exactamente 8 n\xFAmeros","[0-9]{10}":"Debe contener exactamente 10 n\xFAmeros"}[e.pattern||""]||"Formato de documento inv\xE1lido"}catch{return"Formato de documento inv\xE1lido"}return""}getMaxLength(){if(!this.selectedDocumentType)return null;try{let t=this.selectedDocumentType.reglasValidacion.replace(/(['"])?([a-zA-Z0-9_]+)(['"])?:/g,'"$2":').replace(/'/g,'"').replace(/\s/g,"");return JSON.parse(t).max||null}catch{return null}}parseValidationRules(t){try{let e=t.replace(/(['"])?([a-zA-Z0-9_]+)(['"])?:/g,'"$2":').replace(/'/g,'"').replace(/\s/g,"");return JSON.parse(e)}catch(e){return console.error("Error parsing validation rules:",e),{min:3,max:20,pattern:"[0-9]+"}}}generateCertificate(){if(this.certificateForm.invalid)return;let t=this.certificateForm.value,e=this._certificateCodeSrv.generateCertificateCode(t.documentNumber,parseInt(t.validityYear),t.courseName);this.previewGenerated.emit({formData:t,certCode:e})}downloadCertificate(){this.downloadRequested.emit()}onSubmit(){if(!this.certificateForm.value||!this.certificateCode){P.error("No hay datos del certificado para guardar");return}let t={studentName:this.certificateForm.value.studentName,documentType:this.certificateForm.value.documentType,documentNumber:this.certificateForm.value.documentNumber,expeditionPlace:this.certificateForm.value.expeditionPlace,courseName:this.certificateForm.value.courseName,hours:this.certificateForm.value.hours,email:this.certificateForm.value.email,validityYear:this.certificateForm.value.validityYear,code:this.certificateCode};this.saveRequested.emit(t)}sendEmail(){}decode(){console.log("Decodificando:",this.certificateCode);let t=this.certificateForm.get("documentNumber")?.value;console.log("N\xFAmero de documento:",t);let e=this._certificateSrv.decodeCertificateCode(this.certificateCode,t);e?(console.log("Informaci\xF3n decodificada:",e),e.verification.studentIdMatch?console.log("\xA1El certificado pertenece al estudiante!"):console.log("El certificado NO corresponde al estudiante proporcionado")):console.log("No se pudo decodificar el certificado")}static \u0275fac=function(e){return new(e||c)};static \u0275cmp=O({type:c,selectors:[["app-certificate-form"]],viewQuery:function(e,i){if(e&1&&(v(Ae,5),v(qe,5),v(Le,5),v(Ge,5),v(ke,5)),e&2){let a;y(a=w())&&(i.nameInput=a.first),y(a=w())&&(i.docInput=a.first),y(a=w())&&(i.placeInput=a.first),y(a=w())&&(i.emailInput=a.first),y(a=w())&&(i.hoursInput=a.first)}},inputs:{isPreviewGenerated:"isPreviewGenerated",certificateCode:"certificateCode"},outputs:{previewGenerated:"previewGenerated",downloadRequested:"downloadRequested",saveRequested:"saveRequested",formValueChanged:"formValueChanged"},decls:93,vars:14,consts:[["nameInput",""],["placeInput",""],["emailInput",""],["courseInput",""],["auto","matAutocomplete"],[1,"certificate"],[1,"certificate__content"],[1,"certificate__form",3,"ngSubmit","formGroup"],[1,"form-section"],[1,"section-title"],[1,"form-row","full-width"],["appearance","fill",1,"certificate__field"],["matInput","","formControlName","studentName",3,"input"],["mat-icon-button","","matSuffix","",3,"click"],[1,"form-row","two-columns"],["formControlName","documentType"],[3,"value"],["matInput","","formControlName","documentNumber"],["matInput","","formControlName","expeditionPlace",3,"input"],["matInput","","type","email","formControlName","email",3,"input"],["type","text","matInput","","formControlName","courseName",3,"input","matAutocomplete"],[3,"optionSelected","displayWith"],["formControlName","validityYear"],["matInput","","type","number","formControlName","hours","min","1"],[1,"certificate__actions"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["mat-raised-button","","color","accent","type","button",3,"click","disabled"]],template:function(e,i){if(e&1){let a=ee();n(0,"mat-card",5)(1,"mat-card-content",6)(2,"form",7),u("ngSubmit",function(){return p(a),f(i.generateCertificate())}),n(3,"div",8)(4,"h3",9),o(5,"Datos del Estudiante"),r(),n(6,"div",10)(7,"mat-form-field",11)(8,"mat-label"),o(9,"Nombre del Estudiante"),r(),n(10,"input",12,0),u("input",function(s){return p(a),f(i.onInputTransform(s,"studentName"))}),r(),n(12,"button",13),u("click",function(){p(a);let s=R(11);return f(i.clearField("studentName",s))}),n(13,"mat-icon"),o(14,"close"),r()(),_(15,He,2,0,"mat-error"),r()(),n(16,"div",14)(17,"mat-form-field",11)(18,"mat-label"),o(19,"Tipo de Documento"),r(),n(20,"mat-select",15),k(21,ze,2,2,"mat-option",16,Ye),r(),_(23,Qe,2,0,"mat-error"),r(),n(24,"mat-form-field",11)(25,"mat-label"),o(26,"N\xFAmero de Documento"),r(),E(27,"input",17),n(28,"button",13),u("click",function(){return p(a),f(i.clearField("documentNumber",i.docInput))}),n(29,"mat-icon"),o(30,"close"),r()(),_(31,je,2,1,"mat-error"),r()(),n(32,"div",14)(33,"mat-form-field",11)(34,"mat-label"),o(35,"Lugar de Expedici\xF3n"),r(),n(36,"input",18,1),u("input",function(s){return p(a),f(i.onInputTransform(s,"expeditionPlace"))}),r(),n(38,"button",13),u("click",function(){p(a);let s=R(37);return f(i.clearField("expeditionPlace",s))}),n(39,"mat-icon"),o(40,"close"),r()(),_(41,$e,2,0,"mat-error"),r(),n(42,"mat-form-field",11)(43,"mat-label"),o(44,"Correo Electr\xF3nico"),r(),n(45,"input",19,2),u("input",function(s){return p(a),f(i.onInputTransform(s,"email"))}),r(),n(47,"button",13),u("click",function(){p(a);let s=R(46);return f(i.clearField("email",s))}),n(48,"mat-icon"),o(49,"close"),r()(),_(50,Be,2,0,"mat-error"),r()()(),n(51,"div",8)(52,"h3",9),o(53,"Datos del Curso"),r(),n(54,"div",10)(55,"mat-form-field",11)(56,"mat-label"),o(57,"Nombre del Curso"),r(),n(58,"input",20,3),u("input",function(s){return p(a),f(i.filterCourses(s))}),r(),n(60,"mat-autocomplete",21,4),u("optionSelected",function(s){return p(a),f(i.onCourseSelected(s))}),k(62,Ue,2,2,"mat-option",16,B),r()()(),n(64,"div",14)(65,"mat-form-field",11)(66,"mat-label"),o(67,"V\xE1lido hasta el a\xF1o"),r(),n(68,"mat-select",22),k(69,Ze,2,2,"mat-option",16,B),r(),_(71,Je,2,0,"mat-error"),r(),n(72,"mat-form-field",11)(73,"mat-label"),o(74,"Cantidad de Horas"),r(),E(75,"input",23),n(76,"button",13),u("click",function(){return p(a),f(i.clearField("hours",i.hoursInput))}),n(77,"mat-icon"),o(78,"close"),r()(),_(79,We,2,0,"mat-error"),r()()(),n(80,"div",24)(81,"button",25)(82,"mat-icon"),o(83,"assignment"),r(),o(84," Previsualizar "),r(),n(85,"button",26),u("click",function(){return p(a),f(i.onSubmit())}),n(86,"mat-icon"),o(87,"save"),r(),o(88," Guardar "),r(),n(89,"button",26),u("click",function(){return p(a),f(i.downloadCertificate())}),n(90,"mat-icon"),o(91,"download"),r(),o(92," Descargar "),r()()()()()}if(e&2){let a,d,s,M,C,S,D,L=R(61);l(2),g("formGroup",i.certificateForm),l(13),h((a=i.certificateForm.get("studentName"))!=null&&a.touched&&((a=i.certificateForm.get("studentName"))!=null&&a.errors)?15:-1),l(6),Y(i.documentTypes),l(2),h((d=i.certificateForm.get("documentType"))!=null&&d.touched&&((d=i.certificateForm.get("documentType"))!=null&&d.errors)?23:-1),l(4),K("maxlength",i.getMaxLength()),l(4),h((s=i.certificateForm.get("documentNumber"))!=null&&s.touched&&((s=i.certificateForm.get("documentNumber"))!=null&&s.errors)?31:-1),l(10),h((M=i.certificateForm.get("expeditionPlace"))!=null&&M.touched&&((M=i.certificateForm.get("expeditionPlace"))!=null&&M.errors)?41:-1),l(9),h((C=i.certificateForm.get("email"))!=null&&C.touched&&((C=i.certificateForm.get("email"))!=null&&C.errors)?50:-1),l(8),g("matAutocomplete",L),l(2),g("displayWith",i.displayFn),l(2),Y(i.filteredCourses),l(7),Y(i.validityYears),l(2),h((S=i.certificateForm.get("validityYear"))!=null&&S.touched&&((S=i.certificateForm.get("validityYear"))!=null&&S.errors)?71:-1),l(8),h((D=i.certificateForm.get("hours"))!=null&&D.touched&&((D=i.certificateForm.get("hours"))!=null&&D.errors)?79:-1),l(2),g("disabled",!i.certificateForm.valid),l(4),g("disabled",!i.certificateForm.valid||!i.certificateCode),l(4),g("disabled",!i.certificateForm.valid||!i.certificateCode)}},dependencies:[T,_e,de,ce,se,le,me,fe,ue,pe,Ce,Te,be,he,Me,Ee,Se,Fe,Pe,xe,ve,ye,we,Oe,De,Ie],styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%}[_nghost-%COMP%]   .certificate[_ngcontent-%COMP%]{height:100%}[_nghost-%COMP%]   .certificate__content[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}[_nghost-%COMP%]   .certificate__form[_ngcontent-%COMP%]{flex:1;overflow:auto}.form-section[_ngcontent-%COMP%]{margin-bottom:1.5rem;width:100%}.form-section[_ngcontent-%COMP%]:last-of-type{margin-bottom:1rem}.section-title[_ngcontent-%COMP%]{color:#2c3e50;font-size:1rem;margin-bottom:1rem;padding-bottom:.5rem;border-bottom:1px solid rgba(44,62,80,.1)}.form-row[_ngcontent-%COMP%]{margin-bottom:1rem;width:100%}.form-row.two-columns[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem}@media (max-width: 768px){.form-row.two-columns[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:.75rem}}.form-row.full-width[_ngcontent-%COMP%]{width:100%}.certificate[_ngcontent-%COMP%]{-ms-overflow-style:none;scrollbar-width:none;overflow-y:auto;overflow-x:hidden;max-height:100vh}.certificate[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.certificate__actions[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-top:1.5rem;padding-bottom:1.5rem;justify-content:center;flex-wrap:wrap;width:100%}@media (max-width: 768px){.certificate__actions[_ngcontent-%COMP%]{flex-direction:column;width:100%;gap:.75rem}}.certificate__actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:14px;height:44px;padding:0 24px;min-width:200px;margin:0 .5rem}@media (max-width: 768px){.certificate__actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;margin:0}}.certificate__actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{font-size:20px;height:20px;width:20px;margin-right:8px}.certificate__form[_ngcontent-%COMP%], .certificate__content[_ngcontent-%COMP%]{padding:1rem}  .mat-mdc-card{border-radius:8px;box-shadow:0 1px 3px #0000001a!important}  .mat-mdc-form-field{width:100%}  .mat-mdc-text-field-wrapper{padding-top:0;padding-bottom:0}  .mat-mdc-form-field-flex{min-height:48px!important}  .mat-mdc-form-field-infix{padding:30px 0 5px!important;min-height:48px!important}  .mdc-text-field--filled .mdc-floating-label{top:10px;transform:translateY(0)!important}  .mdc-text-field--filled.mdc-text-field--focused .mdc-floating-label,   .mdc-text-field--filled .mdc-floating-label--float-above{top:10px;transform:translateY(-10px) scale(.75)!important}  .mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-floating-label{color:#4a5568cc}  .mat-mdc-raised-button{border-radius:8px}  .mat-form-field-suffix .mat-icon-button{width:24px;height:24px;line-height:24px}  .mat-form-field-suffix .mat-icon-button .mat-icon{font-size:18px;line-height:18px;height:18px;width:18px;color:#4a556880;transition:color .3s ease}  .mat-form-field-suffix .mat-icon-button .mat-icon:hover{color:#4a5568}"]})};var Xe=["certificateElement"],j=class c{certificateElement;formData;currentDate=new Date;yearSelected=new Date;certificateCode="";getCertificateElement(){return this.certificateElement.nativeElement}static \u0275fac=function(e){return new(e||c)};static \u0275cmp=O({type:c,selectors:[["app-certificate-preview"]],viewQuery:function(e,i){if(e&1&&v(Xe,5),e&2){let a;y(a=w())&&(i.certificateElement=a.first)}},inputs:{formData:"formData",currentDate:"currentDate",yearSelected:"yearSelected",certificateCode:"certificateCode"},decls:52,vars:24,consts:[["certificateElement",""],[1,"certificate-preview"],[1,"certificate-preview__content"],[1,"content-wrapper"],[1,"title-group"],[1,"title"],[1,"company-info"],[1,"student-group"],[1,"student-name"],[1,"id-info"],[1,"course-info"],[1,"course-name"],[1,"signatures"],[1,"representante"],["src","images/fir_rep_legal.jpg","alt","Firma"],[1,"director"],["src","images/fir_dir_general.jpg","alt","Firma"],[1,"verification-info"],["href","https://cdcreanimarte.github.io/certificaciones/"]],template:function(e,i){e&1&&(n(0,"div",1,0)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h1",5),o(6,"DE ASISTENCIA SEG\xDAN RESOLUCI\xD3N 3100 DE 2019"),r(),n(7,"div",6),o(8,"NIT 9012123811 CDCREANIMARTE"),r()(),n(9,"div",7)(10,"h2",8),o(11),r(),n(12,"div",9),o(13),I(14,"mask"),I(15,"uppercase"),r()(),n(16,"div",10)(17,"div"),o(18,"Asisti\xF3 y aprob\xF3 el curso"),r(),n(19,"div",11),o(20),r(),n(21,"div"),o(22),r()(),n(23,"div",12)(24,"div",13),E(25,"img",14),n(26,"div"),o(27,"Representante Legal"),r()(),n(28,"div",15),E(29,"img",16),n(30,"div"),o(31,"Director General"),r()()(),n(32,"div",17)(33,"p"),o(34,"Emitido: "),n(35,"span"),o(36),I(37,"date"),r()(),n(38,"p"),o(39,"Vigencia: "),n(40,"span"),o(41),I(42,"date"),I(43,"date"),r()(),n(44,"p"),o(45,"C\xF3digo: "),n(46,"span"),o(47),r()(),n(48,"p"),o(49,"Verificar: "),n(50,"a",18),o(51,"https://cdcreanimarte.github.io/certificaciones"),r()()()()()()),e&2&&(l(11),x(i.formData==null?null:i.formData.studentName),l(2),ne(" IDENTIFICADO CON ",i.formData==null?null:i.formData.documentType,": ",A(14,10,i.formData==null?null:i.formData.documentNumber,"separator.2")," DE ",re(15,13,i.formData==null?null:i.formData.expeditionPlace)," "),l(7),x(i.formData==null?null:i.formData.courseName),l(2),te("con una intensidad de ",i.formData==null?null:i.formData.hours," horas."),l(14),x(A(37,15,i.currentDate,"dd/MM/yyyy")),l(5),ie("",A(42,18,i.currentDate,"yyyy")," - ",A(43,21,i.yearSelected,"yyyy")," "),l(6),x(i.certificateCode))},dependencies:[T,ae,oe,Ne],styles:['[_nghost-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%;height:100%}.certificate-preview[_ngcontent-%COMP%]{width:297mm;height:210mm;margin:0 auto;background:#fff;position:relative;transform-origin:top left;-webkit-print-color-adjust:exact;print-color-adjust:exact;border-radius:8px;box-shadow:0 2px 8px #0000001a;overflow:hidden;padding:1rem}@media (max-width: 1200px){.certificate-preview[_ngcontent-%COMP%]{margin-top:1rem;height:auto;transform:scale(1)}}@media (max-width: 768px){.certificate-preview[_ngcontent-%COMP%]{transform:scale(1)}}@media print{.certificate-preview[_ngcontent-%COMP%]{transform:scale(.3)!important;width:100%;border:none}}.certificate-preview__content[_ngcontent-%COMP%]{width:279.4mm;height:215.9mm;position:relative;background-color:#fff;overflow:hidden;display:grid;grid-template-columns:192px 1fr;margin:0 0 0 35px}.certificate-preview__content[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:10px 0 35px;background:url("./media/template-certificado-F7EXEJCB.png") center/100% 100% no-repeat;z-index:1;background-size:cover}@media (max-width: 1200px){.certificate-preview__content[_ngcontent-%COMP%]{transform:none}}@media (max-width: 768px){.certificate-preview__content[_ngcontent-%COMP%]{transform:none}}.content-wrapper[_ngcontent-%COMP%]{position:relative;z-index:2;grid-column:2;width:100%;margin-top:110px;display:flex;flex-direction:column;align-items:center;text-align:center;padding:2.54cm 1.5cm;margin-left:-372px}.title-group[_ngcontent-%COMP%]{margin-bottom:1.5rem}.title-group[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:20px;font-weight:700;color:#2c3e50;text-transform:uppercase;margin-top:52px;margin-bottom:.5rem;letter-spacing:.5px}.title-group[_ngcontent-%COMP%]   .company-info[_ngcontent-%COMP%]{font-size:20px;font-weight:600;color:#2c3e50}.student-group[_ngcontent-%COMP%]{margin-bottom:1.5rem}.student-group[_ngcontent-%COMP%]   .student-name[_ngcontent-%COMP%]{font-size:30px;font-weight:700;color:#2c3e50;text-transform:uppercase;margin-bottom:.5rem;letter-spacing:.5px}.student-group[_ngcontent-%COMP%]   .id-info[_ngcontent-%COMP%]{font-size:18px;color:#2c3e50;line-height:1.4}.course-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.course-info[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-size:18px;color:#2c3e50;line-height:1.4}.course-info[_ngcontent-%COMP%]   .course-name[_ngcontent-%COMP%]{font-size:24px;font-weight:600;color:#2c3e50;margin:.5rem 0}.signatures[_ngcontent-%COMP%]{display:flex;justify-content:center;width:100%;z-index:2}.signatures[_ngcontent-%COMP%]   .representante[_ngcontent-%COMP%], .signatures[_ngcontent-%COMP%]   .director[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;margin:0 2rem}.signatures[_ngcontent-%COMP%]   .representante[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .signatures[_ngcontent-%COMP%]   .director[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100px;height:100px;object-fit:contain}.signatures[_ngcontent-%COMP%]   .representante[_ngcontent-%COMP%]   div[_ngcontent-%COMP%], .signatures[_ngcontent-%COMP%]   .director[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-size:16px;color:#2c3e50;font-weight:600}.verification-info[_ngcontent-%COMP%]{width:100%;text-align:left;margin-top:auto;margin-left:16rem;padding-top:1.5rem}.verification-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:2px 0 .5px;font-size:15px;color:#2c3e50b3;line-height:1.2}.verification-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:600;color:#2c3e50}.verification-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{font-weight:600;color:#4a90e2;text-decoration:none;transition:color .3s ease}.verification-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}@media print{.certificate-preview[_ngcontent-%COMP%]{position:relative;width:100%;border:none}.certificate-preview__content[_ngcontent-%COMP%]{font-size:10pt;page-break-after:always}}']})};var Ke=["certificateElement"];function et(c,t){if(c&1&&(n(0,"div",3),E(1,"app-certificate-preview",4,0),r()),c&2){let e=H();l(),g("formData",e.certificateData)("currentDate",e.currentDate)("yearSelected",e.yearSelected)("certificateCode",e.certificateCode)}}var Re=class c{certificateElement;certificateGenerated=!1;certificateData=null;currentDate=new Date;yearSelected=new Date;certificateCode="";isGenerating=!1;_certificateSrv=F(z);_certificateCodeSrv=F(N);onFormValueChanged(t){if(this.certificateData=t,this.certificateGenerated){let e=this._certificateCodeSrv.generateCertificateCode(t.documentNumber,parseInt(t.validityYear),t.courseName);this.certificateCode=e.code}}onPreviewGenerated(t){let{formData:e,certCode:i}=t;this.certificateData=e,this.certificateCode=i.code,this.yearSelected=new Date(parseInt(e.validityYear),0,1),this.certificateGenerated=!0}onDownloadRequested(){return $(this,null,function*(){if(!(!this.certificateGenerated||this.isGenerating))try{this.isGenerating=!0;let t=yield this._certificateSrv.generatePDF(this.certificateData,this.currentDate,this.yearSelected,this.certificateCode),e=window.URL.createObjectURL(t),i=document.createElement("a");i.href=e,i.download=`Certificado_${this.certificateData.studentName}.pdf`,i.click(),window.URL.revokeObjectURL(e)}catch(t){console.error("Error en el proceso del certificado:",t),P.error("Error al procesar el certificado")}finally{this.isGenerating=!1}})}onSaveRequested(t){return $(this,null,function*(){if(!t){P.error("No hay datos del certificado para guardar");return}try{yield this._certificateSrv.add(t),P.success("Certificado guardado exitosamente")}catch(e){console.error("Error al guardar el certificado:",e),P.error("El certificado no pudo ser guardado")}})}static \u0275fac=function(e){return new(e||c)};static \u0275cmp=O({type:c,selectors:[["app-certificate-container"]],viewQuery:function(e,i){if(e&1&&v(Ke,5),e&2){let a;y(a=w())&&(i.certificateElement=a.first)}},decls:3,vars:3,consts:[["certificateElement",""],[1,"page-container"],[3,"previewGenerated","formValueChanged","downloadRequested","saveRequested","isPreviewGenerated","certificateCode"],[1,"preview-container"],[3,"formData","currentDate","yearSelected","certificateCode"]],template:function(e,i){e&1&&(n(0,"div",1)(1,"app-certificate-form",2),u("previewGenerated",function(d){return i.onPreviewGenerated(d)})("formValueChanged",function(d){return i.onFormValueChanged(d)})("downloadRequested",function(){return i.onDownloadRequested()})("saveRequested",function(d){return i.onSaveRequested(d)}),r(),_(2,et,3,4,"div",3),r()),e&2&&(l(),g("isPreviewGenerated",i.certificateGenerated)("certificateCode",i.certificateCode),l(),h(i.certificateGenerated?2:-1))},dependencies:[T,Q,j],styles:["[_nghost-%COMP%]{display:grid;grid-template-columns:minmax(600px,650px) 1fr;gap:1.5rem;height:100vh;background:#f5f7fa;max-height:100vh;overflow:hidden}@media (max-width: 1400px){[_nghost-%COMP%]{grid-template-columns:1fr;height:auto;max-height:none}}.preview-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:flex-start;width:100%;height:100%;overflow:auto;padding:1rem;background:#f5f5f5}@media (max-width: 1200px){.preview-container[_ngcontent-%COMP%]{padding:.5rem}}"]})};export{Re as CertificateContainerComponent};
